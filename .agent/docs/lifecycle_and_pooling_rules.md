# ‚ôªÔ∏è Lifecycle and Pooling Rules

–í NewTower (–∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π Garbage Collector'–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–∞—Ö) –º—ã –∞–∫—Ç–∏–≤–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω **Object Pooling**. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —á–∞—Å—Ç–æ —Å–æ–∑–¥–∞—é—Ç—Å—è –∏ —É–Ω–∏—á—Ç–æ–∂–∞—é—Ç—Å—è (–ø—É–ª–∏, –≤—Ä–∞–≥–∏, —Ç–µ–∫—Å—Ç—ã —É—Ä–æ–Ω–∞, —á–∞—Å—Ç–∏—Ü—ã), **–Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `new` –∏ —Å–±–æ—Ä–∫—É –º—É—Å–æ—Ä–∞**. –û–Ω–∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è.

## –ì–ª–∞–≤–Ω—ã–π –ü—Ä–∏–Ω—Ü–∏–ø: Zero-Allocation –≤ Hot-Paths

–í —Ñ—É–Ω–∫—Ü–∏—è—Ö `update()`, `draw()`, `takeDamage()` —Å—Ç—Ä–æ–≥–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `new` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤, –º–∞—Å—Å–∏–≤–æ–≤ –∏–ª–∏ –æ–±—ä–µ–∫—Ç–æ–≤ `{ x, y }`.
–õ—é–±–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ (allocation) –Ω–∞ –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç Garbage Collector "–∏–∫–∞—Ç—å", —Å–æ–∑–¥–∞–≤–∞—è –ª–∞–≥-—Å–ø–∞–π–∫–∏ (GC Spikes).

---

## üèóÔ∏è –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –ø—É–ª–∏—Ä—É–µ–º–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ (Enemy / Projectile / Particle)

### 1. –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä (`constructor`)

–í—ã–∑—ã–≤–∞–µ—Ç—Å—è **–æ–¥–∏–Ω —Ä–∞–∑** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—É–ª–∞. –û–Ω —Ç–æ–ª—å–∫–æ –≤—ã–¥–µ–ª—è–µ—Ç "–∂–µ—Å—Ç–∫—É—é" –ø–∞–º—è—Ç—å.
*–ó–¥–µ—Å—å —Å–æ–∑–¥–∞—é—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã –∏ –Ω—É–ª–µ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã `{ x: 0, y: 0 }`.*

### 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (`init`)

–í—ã–∑—ã–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç –¥–æ—Å—Ç–∞—é—Ç –∏–∑ –ø—É–ª–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã.
–ó–¥–µ—Å—å –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–∏—Ç–∏–≤—ã** (—á–∏—Å–ª–∞, —Å—Ç—Ä–æ–∫–∏, –±—É–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è).

### 3. –û—Å–Ω–æ–≤–Ω–æ–π –¶–∏–∫–ª (`update`/`draw`)

–ì–æ—Ä—è—á–∏–π –ø—É—Ç—å (hot path). **–ë–µ–∑ `new`!** –õ—é–±–∞—è –≥–µ–æ–º–µ—Ç—Ä–∏—è –∏–ª–∏ –≤–µ–∫—Ç–æ—Ä–∞ —Å—á–∏—Ç–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ zero-allocation –æ–±—ä–µ–∫—Ç—ã (–Ω–∞–ø—Ä. `private _moveVector = { x: 0, y: 0 };`).

### 4. –°–º–µ—Ä—Ç—å (`die`)

–ó–∞–ø—É—Å–∫ —Å–ø–µ—Ü—ç—Ñ—Ñ–µ–∫—Ç–æ–≤, –≤—ã–¥–∞—á–∞ –Ω–∞–≥—Ä–∞–¥, –≤—ã–∑–æ–≤ `EVENT_DIED`. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–∞ "–ì–æ—Ç–æ–≤ –∫ –≤–æ–∑–≤—Ä–∞—Ç—É –≤ –ø—É–ª" (`hp = 0` –∏–ª–∏ `alive = false`).

### 5. –°–±—Ä–æ—Å (`reset`) - üíÄ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –≠–¢–ê–ü

–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –ø—É–ª–∞ *—Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ–±—ä–µ–∫—Ç–∞ –≤ —Ä–µ–∑–µ—Ä–≤*.
–ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å **–ø–∞—Ä–∞–Ω–æ–∏–¥–∞–ª—å–Ω–∞—è –ø–æ–¥—á–∏—Å—Ç–∫–∞**. –û—á–∏—â–∞–π—Ç–µ –∞–±—Å–æ–ª—é—Ç–Ω–æ –≤—Å–µ –ø–æ–ª—è, —Ç–∞–π–º–µ—Ä—ã, —Å—á–µ—Ç—á–∏–∫–∏ —Å—Ç–∞–∫–æ–≤, –∏ ID'—à–Ω–∏–∫–∏, —á—Ç–æ–±—ã —Å–ª–µ–¥—É—é—â–∏–π –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∏—Ç —ç—Ç–æ—Ç –∫—É—Å–æ–∫ –ø–∞–º—è—Ç–∏, –Ω–µ —Ä–æ–¥–∏–ª—Å—è —Å —É–∂–µ –≤–∏—Å—è—â–∏–º –Ω–∞ –Ω—ë–º –Ø–¥–æ–º –∏–ª–∏ –©–∏—Ç–æ–º.

---

## üö® –û–ø–∞—Å–Ω–æ—Å—Ç—å –ù–µ–ø–æ–ª–Ω–æ–≥–æ `reset()`

–°–∞–º–∞—è —á–∞—Å—Ç–∞—è –æ—à–∏–±–∫–∞ - –∑–∞–±—ã—Ç—å –æ–±–Ω—É–ª–∏—Ç—å –º–∞—Å—Å–∏–≤—ã –±–∞—Ñ–æ–≤ –∏–ª–∏ —Ç–∞—Ä–≥–µ—Ç-—Å–ª–æ—Ç—ã. –í –∏—Ç–æ–≥–µ "–Ω–æ–≤—ã–π" –≤—Ä–∞–≥ —Ä–æ–∂–¥–∞–µ—Ç—Å—è –∏ —Ç—É—Ç –∂–µ —É–º–∏—Ä–∞–µ—Ç –æ—Ç –≥–æ—Ä–µ–Ω–∏—è, –ø–æ–≤–µ—à–µ–Ω–Ω–æ–≥–æ –Ω–∞ "—Å—Ç–∞—Ä–æ–≥–æ" –≤—Ä–∞–≥–∞ 2 –º–∏–Ω—É—Ç—ã –Ω–∞–∑–∞–¥.

**–ö–∞–∫ –æ—á–∏—â–∞—Ç—å –º–∞—Å—Å–∏–≤—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**

```typescript
// ‚ùå –ü–ª–æ—Ö–æ (Allocation - —Å–æ–∑–¥–∞—Å—Ç –º—É—Å–æ—Ä)
this.myBuffs = []; 

// ‚úÖ –•–æ—Ä–æ—à–æ (–ü–µ—Ä–µ–∑–∞–ø–∏—Å—å –¥–ª–∏–Ω—ã –º–∞—Å—Å–∏–≤–∞, O(1) –∏ –±–µ–∑ –∞–ª–ª–æ–∫–∞—Ü–∏–π)
this.myBuffs.length = 0;
```

**–ö–∞–∫ –æ—á–∏—â–∞—Ç—å —Å—Å—ã–ª–∫–∏:**
–ï—Å–ª–∏ –≤–∞—à –æ–±—ä–µ–∫—Ç –¥–µ—Ä–∂–∞–ª —Å—Å—ã–ª–∫—É –Ω–∞ –¥—Ä—É–≥–æ–π DOM —ç–ª–µ–º–µ–Ω—Ç, –∫–ª–∞—Å—Å –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏—é ‚Äî –æ–±–Ω—É–ª–∏—Ç–µ –µ—ë (`null` –∏–ª–∏ `undefined`), –∏–Ω–∞—á–µ —ç—Ç–æ —Å–ø—Ä–æ–≤–æ—Ü–∏—Ä—É–µ—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫—É—é —É—Ç–µ—á–∫—É –ø–∞–º—è—Ç–∏ (Memory Leak), —Ç–∞–∫ –∫–∞–∫ –ø—É–ª –±—É–¥–µ—Ç –≤–µ—á–Ω–æ —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å—Å—ã–ª–∫—É, –Ω–µ –¥–∞–≤–∞—è GC –µ–µ —É–¥–∞–ª–∏—Ç—å.
