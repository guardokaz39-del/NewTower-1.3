# üè≠ –ü–∞–π–ø–ª–∞–π–Ω –°–æ–∑–¥–∞–Ω–∏—è –í—Ä–∞–≥–∞ (End-to-End)

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π –ø–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –≤—Ä–∞–≥–∞ –≤ –∏–≥—Ä—É. –ü—Ä–∏ —Å–æ–±–ª—é–¥–µ–Ω–∏–∏ –≤—Å–µ—Ö —à–∞–≥–æ–≤ –≤—ã –∏–∑–±–µ–∂–∏—Ç–µ –æ—à–∏–±–æ–∫ —Ç–∏–ø–æ–≤ (`typecheck`), –ø–∞–¥–µ–Ω–∏—è FPS (–∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–ø—Ä–∞–π—Ç–æ–≤) –∏ –Ω–µ–≤–∏–¥–∏–º—ã—Ö –≤—Ä–∞–≥–æ–≤.

## –®–∞–≥ 1: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –°—Ç–∞—Ç–æ–≤ (`Enemies.ts`)

–§–∞–π–ª: `src/config/Enemies.ts`

–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É `ENEMY_TYPES`. –ó–¥–µ—Å—å –∑–∞–¥–∞—é—Ç—Å—è –≥–µ–π–º–ø–ª–µ–π–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–±–∞–ª–∞–Ω—Å).

```typescript
NEW_ENEMY_ID: {
    id: 'new_enemy_id', // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å—Ç—Ä–æ–∫–æ–≤—ã–π ID (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è SpriteBaker –∏ —Å–ø–∞–≤–Ω–∞)
    name: '–ù–∞–∑–≤–∞–Ω–∏–µ –í—Ä–∞–≥–∞',
    symbol: '‚öîÔ∏è', // –≠–º–æ–¥–∑–∏ –¥–ª—è UI
    hpMod: 1.5, // –ú–Ω–æ–∂–∏—Ç–µ–ª—å –±–∞–∑–æ–≤–æ–≥–æ HP –≤–æ–ª–Ω—ã
    speed: 80, // –°–∫–æ—Ä–æ—Å—Ç—å –≤ –ø–∏–∫—Å–µ–ª—è—Ö/—Å–µ–∫
    reward: 5, // –ó–æ–ª–æ—Ç–æ –∑–∞ —É–±–∏–π—Å—Ç–≤–æ
    color: '#ff0000', // –¶–≤–µ—Ç –¥–ª—è fallback –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∏ UI
    desc: '–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –±–µ—Å—Ç–∏–∞—Ä–∏—è.',
    archetype: 'NEW_ENEMY_TYPE', // –°—Å—ã–ª–∫–∞ –∏–∑ types.ts (—Å–º. –®–∞–≥ 2)
    scale: 1.1, // –í–∏–∑—É–∞–ª—å–Ω—ã–π –º–∞—Å—à—Ç–∞–± (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, 1.0 –ø–æ —É–º–æ–ª—á.)
}
```

## –®–∞–≥ 2: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ê—Ä—Ö–µ—Ç–∏–ø–∞ (`types.ts`)

–§–∞–π–ª: `src/types.ts`

–ß—Ç–æ–±—ã Typescript –Ω–µ —Ä—É–≥–∞–ª—Å—è –Ω–∞ –ø–æ–ª–µ `archetype` –∏–∑ –ø–µ—Ä–≤–æ–≥–æ —à–∞–≥–∞, –¥–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫–æ–≤—ã–π –ª–∏—Ç–µ—Ä–∞–ª –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–ª–∏ —Ç–∏–ø `EnemyType` (–µ—Å–ª–∏ —Ç–∞–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è union type).

```typescript
// –ü—Ä–∏–º–µ—Ä:
export type EnemyArchetype = 'GRUNT' | 'ORC' | 'SKELETON' | 'NEW_ENEMY_TYPE';
```

## –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –†–µ–Ω–¥–µ—Ä–µ—Ä–∞ (`NewEnemyRenderer.ts`)

–§–∞–π–ª: `src/renderers/units/NewEnemyRenderer.ts`

–°–æ–∑–¥–∞–π—Ç–µ –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–µ—Ä.

- –î–ª—è –≥—É–º–∞–Ω–æ–∏–¥–æ–≤-—Å–∫–µ–ª–µ—Ç–æ–≤ (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏) –Ω–∞—Å–ª–µ–¥—É–π—Ç–µ—Å—å –æ—Ç `BaseSkeletonRenderer`.
- –î–ª—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–æ–≤—ã—Ö –º–æ–Ω—Å—Ç—Ä–æ–≤ –Ω–∞—Å–ª–µ–¥—É–π—Ç–µ—Å—å –æ—Ç `CachedUnitRenderer`.

**‚ö†Ô∏è –ß–∞—Å—Ç–∞—è –æ—à–∏–±–∫–∞: –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã**
–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –æ–±—â—É—é –±–∞–∑—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `BaseSkeletonRenderer`), –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–π—Ç–µ —Ü–≤–µ—Ç–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ `override` —Å–≤–æ–π—Å—Ç–≤–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ (Instance Properties), –∞ –Ω–µ —á–µ—Ä–µ–∑ `static`. –°—Ç–∞—Ç–∏–∫–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –∫–ª–∞—Å—Å—É –∏ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ—á–µ—Ä–Ω–∏–º –∫–ª–∞—Å—Å–∞–º –ª–µ–≥–∫–æ –º–µ–Ω—è—Ç—å —Ü–≤–µ—Ç–∞ "–ø–æ–¥ —Å–µ–±—è".

```typescript
import { CachedUnitRenderer } from './CachedUnitRenderer';

export class NewEnemyRenderer extends CachedUnitRenderer {
    protected override orientationMode = 'FLIP' as const; 
    
    // ... —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è drawFrame()
}
```

### ü¶¥ –î–ª—è –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤ `BaseSkeletonRenderer` ‚Äî –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û

–ï—Å–ª–∏ –≤–∞—à —Ä–µ–Ω–¥–µ—Ä–µ—Ä –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç `BaseSkeletonRenderer`, –≤ –º–µ—Ç–æ–¥–µ `drawHeadDecoration()` **–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–∑–≤–∞—Ç—å** `this.drawSkull()` –ø–µ—Ä–µ–¥ –æ—Ç—Ä–∏—Å–æ–≤–∫–æ–π —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏ (—à–ª–µ–º, –∫–∞–ø—é—à–æ–Ω –∏ —Ç.–¥.). –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å **–ù–ï —Ä–∏—Å—É–µ—Ç —á–µ—Ä–µ–ø –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** ‚Äî –æ–Ω –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç —ç—Ç–æ –ø–æ–¥–∫–ª–∞—Å—Å–∞–º.

> [!CAUTION]
> –ë–µ–∑ –≤—ã–∑–æ–≤–∞ `this.drawSkull()` —É –≤—Ä–∞–≥–∞ –±—É–¥–µ—Ç —à–ª–µ–º/–∫–∞—Å–∫–∞, –Ω–æ –Ω–µ –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ –≥–æ–ª–æ–≤—ã! –ö–∞—Å–∫–∞ –±—É–¥–µ—Ç "–≤–∏—Å–µ—Ç—å" –Ω–∞ —Ç–µ–ª–µ.

```typescript
export class SkeletonMinerRenderer extends BaseSkeletonRenderer {
    protected override eyeGlow = '#66bb6a'; // –¶–≤–µ—Ç —Å–≤–µ—á–µ–Ω–∏—è –≥–ª–∞–∑ (–ø–æ —É–º–æ–ª—á. –∫—Ä–∞—Å–Ω—ã–π)
    
    protected drawHeadDecoration(ctx: CanvasRenderingContext2D, pose: SkeletonPose): void {
        ctx.save();
        ctx.translate(head.x, head.y);
        ctx.rotate(head.angle);
        
        // ‚úÖ –°–ù–ê–ß–ê–õ–ê —á–µ—Ä–µ–ø, –ü–û–¢–û–ú —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞
        this.drawSkull(ctx, s, pose.facing);
        
        // ... –∫–∞—Å–∫–∞, —à–ª–µ–º, —É–∫—Ä–∞—à–µ–Ω–∏—è –ø–æ–≤–µ—Ä—Ö —á–µ—Ä–µ–ø–∞
        ctx.restore();
    }
}
```

**–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –±–∞–∑–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞:**

| –°–≤–æ–π—Å—Ç–≤–æ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `boneMain` | `string` | –¶–≤–µ—Ç –∫–æ—Å—Ç–∏ (—Å–≤–µ—Ç–ª—ã–π) |
| `boneShadow` | `string` | –¶–≤–µ—Ç –æ–±–≤–æ–¥–∫–∏ (—Ç—ë–º–Ω—ã–π) |
| `boneDark` | `string` | –¶–≤–µ—Ç —Ä–µ—Ü–µ—Å—Å–∏–≤–Ω—ã—Ö –∫–æ—Å—Ç–µ–π |
| `eyeGlow` | `string` | –¶–≤–µ—Ç —Å–≤–µ—á–µ–Ω–∏—è –≥–ª–∞–∑ (–ø–æ —É–º–æ–ª—á. `#d32f2f`) |
| `headRadius` | `number` | –†–∞–¥–∏—É—Å —á–µ—Ä–µ–ø–∞ (–ø–æ —É–º–æ–ª—á. `5.5`) |

## –®–∞–≥ 4: –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –ê—Ä—Ö–µ—Ç–∏–ø–∞ —Å –†–µ–Ω–¥–µ—Ä–µ—Ä–æ–º (`EnemyRenderer.ts`)

–§–∞–π–ª: `src/renderers/EnemyRenderer.ts`

–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Å–≤–æ–π –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å –∏ –¥–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ –º–∞–ø—É (—Å–ª–æ–≤–∞—Ä—å) —Ä–µ–Ω–¥–µ—Ä–µ—Ä–æ–≤. –≠—Ç–æ —Å–∫–∞–∂–µ—Ç –∏–≥—Ä–µ: "–ö–æ–≥–¥–∞ –≤–∏–¥–∏—à—å –≤—Ä–∞–≥–∞ —Ç–∏–ø–∞ `NEW_ENEMY_TYPE`, —Ä–∏—Å—É–π –µ–≥–æ –∫–ª–∞—Å—Å–æ–º `NewEnemyRenderer`".

```typescript
import { NewEnemyRenderer } from './units/NewEnemyRenderer';

export class EnemyRenderer {
    private static renderers: Record<string, UnitRenderer> = {
        'SKELETON': new SkeletonUnitRenderer(),
        'NEW_ENEMY_TYPE': new NewEnemyRenderer(), // –î–æ–±–∞–≤—å—Ç–µ —Å—é–¥–∞
    };
    // ...
}
```

## –®–∞–≥ 5: –ó–∞–ø–µ–∫–∞–Ω–∏–µ –°–ø—Ä–∞–π—Ç–æ–≤ (SpriteBaker) - üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û

–§–∞–π–ª: `src/Assets.ts`

–ï—Å–ª–∏ –≤—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —à–∞–≥, –≤—Ä–∞–≥ –±—É–¥–µ—Ç —Ä–∏—Å–æ–≤–∞—Ç—å—Å—è –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–æ –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä, —á—Ç–æ **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ —É–±—å–µ—Ç FPS** –ø—Ä–∏ —Å–ø–∞–≤–Ω–µ —Ç–æ–ª–ø—ã. –õ–∏–±–æ —Å–ø—Ä–∞–π—Ç—ã –±—É–¥—É—Ç –±—Ä–∞—Ç—å—Å—è –∏–∑ –ø—É—Å—Ç—ã—Ö –∫–∞–Ω–≤–∞—Å–æ–≤.

–ù–∞–π–¥–∏—Ç–µ –º–µ—Ç–æ–¥ `generateBakedSprites()` –≤ –∫–ª–∞—Å—Å–µ `Assets` –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤—ã–∑–æ–≤ `SpriteBaker`.

```typescript
import { NewEnemyRenderer } from './renderers/units/NewEnemyRenderer';

// –í–Ω—É—Ç—Ä–∏ generateBakedSprites():
SpriteBaker.bakeWalkCycle('new_enemy_id', new NewEnemyRenderer()); // –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ—Ç –∂–µ id –∏–∑ Enemies.ts!
```

> **–í–∞–∂–Ω–æ:** `SpriteBaker` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `id` (–∫–ª—é—á), –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Ç–æ–º –∫–ª–∞—Å—Å `CachedUnitRenderer` –±—É–¥–µ—Ç –∏—Å–∫–∞—Ç—å –≤ `AssetCache`. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `id` –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ. –ï—Å–ª–∏ –∫–ª—é—á–∏ –Ω–µ —Å–æ–≤–ø–∞–¥—É—Ç, –∫—ç—à –Ω–µ –±—É–¥–µ—Ç –Ω–∞–π–¥–µ–Ω.

## –®–∞–≥ 6: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –ö–æ–Ω—Å–æ–ª—å –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–§–∞–π–ª: `src/ui/DevConsole.ts`

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —É–¥–æ–±–Ω–æ –∑–∞—Ç–µ—Å—Ç–∏—Ç—å –≤—Ä–∞–≥–∞ –≤ –∏–≥—Ä–µ –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –Ω—É–∂–Ω–æ–π –≤–æ–ª–Ω—ã, –¥–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ –ø–∞–Ω–µ–ª—å —á–∏—Ç–æ–≤. –í –º–µ—Ç–æ–¥–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ UI –Ω–∞–π–¥–∏—Ç–µ –º–∞—Å—Å–∏–≤ `enemyTypes` –∏ –¥–æ–±–∞–≤—å—Ç–µ —Ç—É–¥–∞ —Å–≤–æ–π ID.

```typescript
const enemyTypes = [
    'GRUNT', 'SCOUT', 'TANK', 'BOSS', 'ORC_WARRIOR', 'SKELETON', 'NEW_ENEMY_ID' // <‚Äî
];
```

## üõ† –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ (Verification)

1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É `npm run typecheck`, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–∏ –æ–¥–∏–Ω —à–∞–≥ –∏–º–ø–æ—Ä—Ç–æ–≤ –Ω–µ –∑–∞–±—ã—Ç.
2. –í Dev Console –Ω–∞–∂–º–∏—Ç–µ `Spawn NEW_ENEMY_ID`.
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –≤—Ä–∞–≥ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç—Å—è.
4. –í—ã–¥–µ–ª–∏—Ç–µ –≤—Ä–∞–≥–∞ (Inspector) –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ–≥–æ —Å—Ç–∞—Ç—ã (HP, –ë—Ä–æ–Ω—è, –°–∫–æ—Ä–æ—Å—Ç—å) —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∫–æ–Ω—Ñ–∏–≥—É `Enemies.ts`.
